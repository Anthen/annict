FROM ruby:2.5.1-alpine

LABEL maintainer="https://annict.com/@shimbaco" \
      description="A platform for anime addicts."

RUN apk update && \
    apk add -t build-dependencies \
        build-base \
        postgresql \
        postgresql-dev \
        nodejs-npm

ENV RAILS_ENV=development

# Set to install cld gem
# https://github.com/jtoy/cld/issues/10
ENV CFLAGS="-Wno-narrowing"
ENV CXXFLAGS="$CFLAGS"

RUN apk add --update build-base postgresql-dev tzdata

WORKDIR /annict/

COPY Gemfile Gemfile.lock /annict/
RUN bundle install -j$(getconf _NPROCESSORS_ONLN) && \
    npm i -g mjml@4.1.2

COPY . /annict/

EXPOSE 3000
